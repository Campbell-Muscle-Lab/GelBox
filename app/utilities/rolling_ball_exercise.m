function rolling_ball(image, radius)

x = load('ecg.mat');

ecg_10 = load('ecg_10.mat');
ecg_10 = ecg_10.ecg_10;

ecg_80 = load('ecg_80.mat');
ecg_80 = ecg_80.ecg_80;
prof = load('prof.mat');
prof = prof.x;
% prof = [[14565.0327868852;14661.9836065574;14744.1639344262;14804.5081967213;14877.8852459016;14896.4590163934;14871.4262295082;15107.8688524590;15435.5901639344;15356.7540983607;15033.8196721311;14900.2786885246;14896.2295081967;14907.8196721311;14866.6065573770;14967.0163934426;15120.6229508197;14946.6885245902;14598.6393442623;14520.6721311475;14525.5901639344;14455.9836065574;14400.3606557377;14433.5409836066;14608.0163934426;14657.4426229508;14512.2459016393;14396.4426229508;14357.8688524590;14351.1967213115;14382.9344262295;14400.8688524590;14388.9672131148;14347.3934426230;14376.9180327869;14337.4098360656;14338.9016393443;14450.7540983607;14360.1803278689;14481.6557377049;14446.2459016393;14419.7704918033;14488.8852459016;14526.5409836066;14597.0491803279;14698.6721311475;14717.4262295082;14735.2950819672;14676.4426229508;14646.1803278689;14576.1967213115;14508.5081967213;14479.8032786885;14399.8524590164;14280.0655737705;14232.4098360656;14156.7868852459;14051.5081967213;13977.0163934426;13984.5573770492;13891.4426229508;13805.5081967213;13745.9508196721;13636.3278688525;13598.8524590164;13531.1147540984;13495.5573770492;13495.2459016393;13500.9016393443;13593.9016393443;13710.8852459016;13819.7213114754;13956.8852459016;14188.2950819672;14402.4754098361;14599.3114754098;14784.4754098361;14942.7540983607;15195.9836065574;15574.5901639344;16156.0983606557;16904.3114754098;17533.6721311475;18359.8852459016;19661.3114754098;21121.9180327869;22585.8688524590;23922.1311475410;25019.5081967213;25736.5409836066;26052.6885245902;25863.2786885246;25396.7049180328;24767.8360655738;23945.8852459016;22873.5409836066;21692;20504.6393442623;19190.9180327869;17954.6885245902;16790.4426229508;15734.9672131148;15005.0327868852;14090.2295081967;12932.2786885246;12255.2459016393;11768.6065573770;11381.3770491803;11170.2131147541;10945.5901639344;10724.8524590164;10535.1147540984;10180.8688524590;9879.73770491803;9760.27868852459;9635.98360655738;9543.31147540984;9435.40983606557;9287.57377049180;9181.83606557377;9092.68852459016;9028.65573770492;8980.68852459016;8914.72131147541;8868.39344262295;8823.98360655738;8776.11475409836;8766.78688524590;8693.59016393443;8687.55737704918;8616.72131147541;8651.80327868853;8642.11475409836;8609.08196721312;8589.78688524590;8559.34426229508;8567.72131147541;8601.59016393443;8581.24590163934;8590.21311475410;8677.44262295082;8700.60655737705;8789.93442622951;8837.37704918033;8664.52459016393;8508.13114754098;8466.93442622951;8455.29508196721;8455.65573770492;8446.90163934426;8448.29508196721;8452.14754098361;8441.27868852459;8448.36065573770;8464.57377049180;8469.65573770492;8431.42622950820;8401.21311475410;8382.44262295082;8341.96721311475;8351.36065573770;8395.91803278689;8496.68852459016;8498.42622950820;8327.55737704918;8268.36065573770;8266.88524590164;8269.60655737705;8301.24590163934;8295.93442622951;8260.91803278689;8272.31147540984;8309.93442622951;8336.54098360656;8266.32786885246;8242.50819672131;8224.37704918033;8242.45901639344;8380.72131147541;8492.39344262295;8447.52459016393;8286.13114754098;8338.88524590164;8282.54098360656;8326.80327868853;8405.49180327869;8474.72131147541;8242.68852459016;8203.45901639344;8206.04918032787;8260.93442622951;8177.93442622951;8153.83606557377;8426.80327868853;8618.57377049180;8406.60655737705;8271.85245901639]];
ecg = x.utku;
lin_back = linspace(prof(1),prof(end),numel(prof))';


radius = 10; 
se = strel('ball', radius, radius, 0);

% filtered_ecg_erode = imerode(ecg, se) + radius;
% filtered_ecg_tophat = imtophat(ecg,se);
filtered_prof_erode = imerode(prof, se)+ radius;
filtered_prof_tophat = imtophat(prof, se);

double_prof_tophat = imtophat(prof-lin_back, se);


figure(1)
clf
hold on

plot(prof,'linewidth',1.75)
plot(prof-filtered_prof_erode,'linewidth',1.75)
plot(filtered_prof_tophat,'linewidth',1.75)
plot(prof-lin_back,'linewidth',1.75)
% plot(double_prof_tophat,'linewidth',1.75)


legend('Profile','Rolling: Imerode','Rolling: Imtophat','Linear Correction','Lin+Roll')

% % plot(ecg_10)
% plot(ecg_80,'o','color','k')
% plot(ecg-filtered_ecg_erode,'linewidth',1.5)
% plot(filtered_ecg_tophat,'linewidth',1.5)

% plot(prof)
% plot(prof-filtered_prof)
% legend('original','me','scikit10','scikit80')
% ylabel('Voltage')
% xlabel('Time')
% xlim([1 numel(ecg)])
box on 
end
